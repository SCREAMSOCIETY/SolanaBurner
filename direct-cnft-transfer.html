<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SolBurn - Direct cNFT Transfer</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f5f5f5;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background-color: #fff;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    .header h1 {
      color: #512da8;
      font-weight: bold;
    }
    .card {
      margin-bottom: 20px;
      border: none;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .card-header {
      background-color: #eee6ff;
      border-bottom: none;
      font-weight: bold;
    }
    .btn-primary {
      background-color: #512da8;
      border-color: #4527a0;
    }
    .btn-primary:hover {
      background-color: #4527a0;
      border-color: #311b92;
    }
    .result-container {
      margin-top: 20px;
      padding: 15px;
      border-radius: 5px;
      background-color: #f8f9fa;
      border: 1px solid #dee2e6;
      white-space: pre-wrap;
      font-family: monospace;
      font-size: 0.85rem;
      max-height: 250px;
      overflow-y: auto;
    }
    .hidden {
      display: none;
    }
    .success-message {
      color: #155724;
      background-color: #d4edda;
      border-color: #c3e6cb;
      padding: 15px;
      border-radius: 5px;
      margin-top: 20px;
    }
    .error-message {
      color: #721c24;
      background-color: #f8d7da;
      border-color: #f5c6cb;
      padding: 15px;
      border-radius: 5px;
      margin-top: 20px;
    }
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(81, 45, 168, 0.3);
      border-radius: 50%;
      border-top-color: #512da8;
      animation: spin 1s ease-in-out infinite;
      margin-right: 10px;
    }
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
    .info-text {
      font-size: 0.9rem;
      color: #6c757d;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>SolBurn - Direct cNFT Transfer</h1>
      <p class="lead">Simple, reliable CLI-based cNFT transfer</p>
    </div>

    <div class="card mb-4">
      <div class="card-header">
        Transfer cNFT to Project Wallet
      </div>
      <div class="card-body">
        <div class="info-text">
          <p>This tool uses a reliable CLI-based approach to transfer your compressed NFTs to our project wallet. This approach is more reliable than browser-based solutions.</p>
          <p><strong>Security Note:</strong> Your private key is used only for this specific transaction and is never stored. For maximum security, you should create a new wallet just for this operation.</p>
        </div>

        <form id="transfer-form">
          <div class="mb-3">
            <label for="private-key" class="form-label">Wallet Private Key (Base58 Encoded)</label>
            <input type="password" class="form-control" id="private-key" placeholder="Enter your private key (base58 encoded)" required>
            <div class="form-text">This is used only for signing the transaction and is not stored.</div>
          </div>
          
          <div class="mb-3">
            <label for="asset-id" class="form-label">Asset ID (cNFT Mint Address)</label>
            <input type="text" class="form-control" id="asset-id" placeholder="Enter the cNFT asset ID" required>
          </div>
          
          <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="use-custom-destination">
            <label class="form-check-label" for="use-custom-destination">Use Custom Destination</label>
          </div>
          
          <div class="mb-3 hidden" id="destination-address-container">
            <label for="destination-address" class="form-label">Destination Address</label>
            <input type="text" class="form-control" id="destination-address" placeholder="Enter destination address">
            <div class="form-text">If not provided, the default project wallet (EYjsLzE9VDy3WBd2beeCHA1eVYJxPKVf6NoKKDwq7ujK) will be used.</div>
          </div>
          
          <button type="submit" class="btn btn-primary">Transfer cNFT</button>
        </form>
      </div>
    </div>

    <div id="loading-container" class="text-center hidden">
      <span class="loading"></span> Processing transfer, please wait...
    </div>

    <div id="success-message" class="success-message hidden">
      <h4>Transfer Successful!</h4>
      <p id="success-details"></p>
      <p>View transaction: <a id="explorer-link" href="#" target="_blank">View on Solscan</a></p>
    </div>

    <div id="error-message" class="error-message hidden">
      <h4>Transfer Failed</h4>
      <p id="error-details"></p>
    </div>

    <div id="result-container" class="result-container hidden"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Elements
      const transferForm = document.getElementById('transfer-form');
      const privateKeyInput = document.getElementById('private-key');
      const assetIdInput = document.getElementById('asset-id');
      const useCustomDestination = document.getElementById('use-custom-destination');
      const destinationAddressContainer = document.getElementById('destination-address-container');
      const destinationAddressInput = document.getElementById('destination-address');
      const loadingContainer = document.getElementById('loading-container');
      const successMessage = document.getElementById('success-message');
      const successDetails = document.getElementById('success-details');
      const explorerLink = document.getElementById('explorer-link');
      const errorMessage = document.getElementById('error-message');
      const errorDetails = document.getElementById('error-details');
      const resultContainer = document.getElementById('result-container');
      
      // Show/hide destination address based on checkbox
      useCustomDestination.addEventListener('change', function() {
        destinationAddressContainer.classList.toggle('hidden', !this.checked);
        if (!this.checked) {
          destinationAddressInput.value = '';
        }
      });
      
      // Handle form submission
      transferForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Get form values
        const privateKey = privateKeyInput.value.trim();
        const assetId = assetIdInput.value.trim();
        const destinationAddress = useCustomDestination.checked ? destinationAddressInput.value.trim() : null;
        
        // Validate inputs
        if (!privateKey) {
          alert('Please enter your private key');
          return;
        }
        
        if (!assetId) {
          alert('Please enter the asset ID');
          return;
        }
        
        if (useCustomDestination.checked && !destinationAddress) {
          alert('Please enter a destination address or uncheck the custom destination option');
          return;
        }
        
        // Show loading
        loadingContainer.classList.remove('hidden');
        successMessage.classList.add('hidden');
        errorMessage.classList.add('hidden');
        resultContainer.classList.add('hidden');
        
        try {
          // Prepare request data
          const requestData = {
            encoded_private_key: privateKey,
            asset_id: assetId
          };
          
          if (destinationAddress) {
            requestData.destination_address = destinationAddress;
          }
          
          // Make API request
          const response = await fetch('/api/cnft/direct-transfer', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestData)
          });
          
          const data = await response.json();
          
          // Hide loading
          loadingContainer.classList.add('hidden');
          
          // Display result
          if (data.success) {
            // Show success message
            successMessage.classList.remove('hidden');
            successDetails.textContent = `The cNFT with ID ${assetId} has been successfully transferred.`;
            
            if (data.signature) {
              explorerLink.href = `https://solscan.io/tx/${data.signature}`;
              explorerLink.textContent = `View on Solscan (${data.signature.substring(0, 8)}...)`;
            } else {
              explorerLink.textContent = 'Transaction ID not available';
              explorerLink.href = '#';
            }
          } else {
            // Show error message
            errorMessage.classList.remove('hidden');
            errorDetails.textContent = data.error || 'An unknown error occurred';
          }
          
          // Show full output
          if (data.output) {
            resultContainer.textContent = data.output;
            resultContainer.classList.remove('hidden');
          }
          
          // Clear private key for security
          privateKeyInput.value = '';
        } catch (error) {
          // Hide loading
          loadingContainer.classList.add('hidden');
          
          // Show error message
          errorMessage.classList.remove('hidden');
          errorDetails.textContent = error.message || 'An unexpected error occurred';
          
          // Clear private key for security
          privateKeyInput.value = '';
        }
      });
    });
  </script>
</body>
</html>