{"version":3,"file":"server-side-patch.js","mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB;AACnB;AACA;AACA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA,mEAAmE,QAAQ;AAC3E;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+CAA+C,WAAW;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B,aAAa;AACvC;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,cAAc;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA,iEAAiE,QAAQ;AACzE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA,CAAC,E","sources":["webpack://workspace/./static/js/server-side-patch.js"],"sourcesContent":["/**\n * Server-Side Transfer Patch for CNFTHandler\n * \n * This script patches the CNFTHandler to use our server-side implementation\n * which avoids client-side TransactionInstruction class issues completely.\n */\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  console.log('[Server-Side-Patch] Initializing...');\n  \n  // Wait for all scripts to load before applying patch\n  window.addEventListener('load', () => {\n    console.log('[Server-Side-Patch] Window loaded, applying patch...');\n    \n    // Try to apply the patch after a short delay\n    setTimeout(() => {\n      applyServerSidePatch();\n    }, 1000);\n  });\n  \n  // Direct patch function\n  function applyServerSidePatch() {\n    // Determine where CNFTHandler is located\n    let CNFTHandlerClass = null;\n    let prototype = null;\n    \n    if (window.CNFTHandler) {\n      console.log('[Server-Side-Patch] Found CNFTHandler on window');\n      CNFTHandlerClass = window.CNFTHandler;\n      prototype = window.CNFTHandler.prototype;\n    } else if (window.cnftHandler && window.cnftHandler.CNFTHandler) {\n      console.log('[Server-Side-Patch] Found CNFTHandler in cnftHandler module');\n      CNFTHandlerClass = window.cnftHandler.CNFTHandler;\n      prototype = window.cnftHandler.CNFTHandler.prototype;\n    }\n    \n    if (!prototype) {\n      console.error('[Server-Side-Patch] Unable to find CNFTHandler class');\n      \n      // As a last resort, create a global handler function\n      window.serverSideTransferCNFT = async function(assetId, proofData, destination) {\n        if (!window.serverSideTransfer) {\n          return { success: false, error: \"Server-side transfer not available\" };\n        }\n        \n        try {\n          // Get connection and wallet from window\n          const connection = window._solanaConnection;\n          const wallet = window._solanaWallet;\n          \n          if (!connection || !wallet) {\n            return { success: false, error: \"Connection or wallet not available\" };\n          }\n          \n          // Use the destination or default to the project wallet\n          const finalDestination = destination || \"EYjsLzE9VDy3WBd2beeCHA1eVYJxPKVf6NoKKDwq7ujK\";\n          \n          // Use our server-side implementation directly\n          return await window.serverSideTransfer.transferCNFT({\n            connection,\n            wallet,\n            assetId,\n            destinationAddress: finalDestination,\n            proofData\n          });\n        } catch (error) {\n          console.error(\"Global serverSideTransferCNFT error:\", error);\n          return {\n            success: false,\n            error: error.message\n          };\n        }\n      };\n      \n      console.log('[Server-Side-Patch] Added global serverSideTransferCNFT function as fallback');\n      return;\n    }\n    \n    // Check if our server-side transfer is available\n    if (!window.serverSideTransfer) {\n      console.error('[Server-Side-Patch] server-side-transfer not found, cannot apply patch');\n      return;\n    }\n    \n    console.log('[Server-Side-Patch] Found required components, applying patch');\n    \n    try {\n      // Save original method\n      const originalTransferCNFTWithProof = prototype.transferCNFTWithProof;\n      \n      // Override with our server-side implementation\n      prototype.transferCNFTWithProof = async function(assetId, providedProofData, destinationAddress = null) {\n        console.log('[Server-Side-Patch] Using server-side implementation');\n        \n        // Basic validation\n        if (!assetId) {\n          return { success: false, error: \"Asset ID is required\" };\n        }\n        \n        if (!providedProofData) {\n          return { success: false, error: \"Proof data is required\" };\n        }\n        \n        try {\n          // Get asset data - we still need this for UI display\n          let assetData = null;\n          try {\n            const assetResponse = await fetch(`/api/helius/asset/${assetId}`);\n            const assetResult = await assetResponse.json();\n            \n            if (assetResult.success && assetResult.data) {\n              assetData = assetResult.data;\n              console.log('[Server-Side-Patch] Asset data fetched successfully');\n            } else {\n              throw new Error(\"Failed to fetch asset data\");\n            }\n          } catch (assetError) {\n            console.error('[Server-Side-Patch] Error fetching asset data:', assetError);\n            throw new Error(\"Failed to get asset data\");\n          }\n          \n          // Default to project wallet if no destination\n          const finalDestination = destinationAddress || \"EYjsLzE9VDy3WBd2beeCHA1eVYJxPKVf6NoKKDwq7ujK\";\n          console.log('[Server-Side-Patch] Destination wallet:', finalDestination);\n          \n          // Show notification to user\n          if (window.BurnAnimations?.showNotification) {\n            window.BurnAnimations.showNotification(\n              \"Processing cNFT Transfer\",\n              \"Creating transaction with server-side implementation...\"\n            );\n          }\n          \n          // Use our server-side implementation\n          console.log('[Server-Side-Patch] Calling server-side implementation');\n          const result = await window.serverSideTransfer.transferCNFT({\n            connection: this.connection,\n            wallet: this.wallet,\n            assetId,\n            destinationAddress: finalDestination,\n            proofData: providedProofData\n          });\n          \n          // Process result\n          if (result.success) {\n            console.log('[Server-Side-Patch] Transfer successful!');\n            \n            // Add to hidden assets\n            if (window.hiddenAssets) {\n              window.hiddenAssets.addHiddenAsset(assetId);\n            }\n            \n            // Show achievement notification\n            if (window.BurnAnimations?.showAchievement) {\n              const assetName = assetData?.content?.metadata?.name || \"cNFT\";\n              window.BurnAnimations.showAchievement(\n                \"cNFT Trashed\",\n                `You've successfully trashed ${assetName} to the project collection.`\n              );\n            }\n            \n            // Track stats\n            if (window.checkAchievements) {\n              window.checkAchievements('cnft_trash', 1);\n            }\n            \n            // Return success\n            return {\n              ...result,\n              assetId,\n              assetData\n            };\n          } else {\n            console.error('[Server-Side-Patch] Transfer failed:', result.error);\n            \n            // Show error notification\n            if (window.BurnAnimations?.showNotification) {\n              window.BurnAnimations.showNotification(\n                \"cNFT Trash Failed\",\n                `Error: ${result.error}`\n              );\n            }\n            \n            return result;\n          }\n        } catch (error) {\n          console.error('[Server-Side-Patch] Transfer error:', error);\n          \n          // Show error notification\n          if (window.BurnAnimations?.showNotification) {\n            window.BurnAnimations.showNotification(\n              \"cNFT Trash Failed\",\n              `Error: ${error.message}`\n            );\n          }\n          \n          // Fallback to original method\n          try {\n            console.log('[Server-Side-Patch] Trying original implementation as fallback');\n            return await originalTransferCNFTWithProof.call(this, assetId, providedProofData, destinationAddress);\n          } catch (fallbackError) {\n            console.error('[Server-Side-Patch] Fallback also failed:', fallbackError);\n            return {\n              success: false,\n              error: error.message,\n              fallbackError: fallbackError.message\n            };\n          }\n        }\n      };\n      \n      console.log('[Server-Side-Patch] Successfully patched CNFTHandler.transferCNFTWithProof');\n      \n      // Provide a direct access function on window\n      window.serverSideTransferCNFT = async function(assetId, proofData, destination) {\n        try {\n          // Get connection and wallet from window\n          const connection = window._solanaConnection;\n          const wallet = window._solanaWallet;\n          \n          if (!connection || !wallet) {\n            return { success: false, error: \"Connection or wallet not available\" };\n          }\n          \n          // Use the destination or default to the project wallet\n          const finalDestination = destination || \"EYjsLzE9VDy3WBd2beeCHA1eVYJxPKVf6NoKKDwq7ujK\";\n          \n          console.log(`[Global] Using server-side transfer for ${assetId}`);\n          \n          // Use our server-side implementation\n          return await window.serverSideTransfer.transferCNFT({\n            connection,\n            wallet,\n            assetId,\n            destinationAddress: finalDestination,\n            proofData\n          });\n        } catch (error) {\n          console.error(\"Global serverSideTransferCNFT error:\", error);\n          return {\n            success: false,\n            error: error.message\n          };\n        }\n      };\n      \n      console.log('[Server-Side-Patch] Added global serverSideTransferCNFT function');\n    } catch (error) {\n      console.error('[Server-Side-Patch] Error applying patch:', error);\n    }\n  }\n});"],"names":[],"sourceRoot":""}