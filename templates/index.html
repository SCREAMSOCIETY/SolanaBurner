<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Solana Token Burner</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Solana Token Burner</h1>
        <div class="wallet-section">
            <button class="connect-button" id="connectWallet">Connect Phantom</button>
            <div class="connected-status" id="walletStatus" style="display: none">
                <div>Wallet Connected</div>
                <div class="wallet-address" id="walletAddress"></div>
            </div>
        </div>
        <div class="burn-form" id="burnForm" style="display: none">
            <div class="input-group">
                <label for="tokenSelect">Select Token:</label>
                <select id="tokenSelect" required>
                    <option value="">Select a token</option>
                </select>
            </div>
            <div class="input-group">
                <label for="amount">Amount to Burn:</label>
                <input type="number" id="amount" step="0.000001" min="0">
            </div>
            <button type="submit" id="burnButton">Burn Tokens</button>
            <div class="status-message" id="statusMessage"></div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const connectButton = document.getElementById('connectWallet');
            const walletStatus = document.getElementById('walletStatus');
            const walletAddress = document.getElementById('walletAddress');
            const burnForm = document.getElementById('burnForm');
            const burnButton = document.getElementById('burnButton');
            const statusMessage = document.getElementById('statusMessage');
            const tokenSelect = document.getElementById('tokenSelect');

            // Fetch available tokens
            fetch('/tokens')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        data.tokens.forEach(token => {
                            const option = document.createElement('option');
                            option.value = token.mint;
                            option.textContent = `${token.name} (${token.symbol})`;
                            tokenSelect.appendChild(option);
                        });
                    }
                })
                .catch(error => {
                    console.error('Error fetching tokens:', error);
                });

            connectButton.addEventListener('click', async () => {
                try {
                    const resp = await window.solana.connect();
                    connectButton.style.display = 'none';
                    walletStatus.style.display = 'block';
                    burnForm.style.display = 'block';
                    const pubKey = resp.publicKey.toString();
                    walletAddress.textContent = `Address: ${pubKey.slice(0,6)}...${pubKey.slice(-6)}`;
                } catch (err) {
                    statusMessage.textContent = 'Failed to connect wallet';
                    statusMessage.className = 'status-message error';
                }
            });

            burnButton.addEventListener('click', async () => {
                const amount = document.getElementById('amount').value;
                const tokenMint = tokenSelect.value;

                if (!tokenMint) {
                    statusMessage.textContent = 'Please select a token';
                    statusMessage.className = 'status-message error';
                    return;
                }

                if (!amount || amount <= 0) {
                    statusMessage.textContent = 'Please enter a valid amount';
                    statusMessage.className = 'status-message error';
                    return;
                }

                try {
                    const response = await fetch('/burn', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ amount, tokenMint }),
                    });
                    const data = await response.json();
                    statusMessage.textContent = data.message;
                    statusMessage.className = `status-message ${data.success ? 'success' : 'error'}`;

                    if (data.success) {
                        document.getElementById('amount').value = '';
                        tokenSelect.value = '';
                    }
                } catch (err) {
                    statusMessage.textContent = 'Failed to burn tokens';
                    statusMessage.className = 'status-message error';
                }
            });
        });
    </script>
</body>
</html>